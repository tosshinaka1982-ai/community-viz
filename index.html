<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>AI Analysis POC</title>
    <style>
      body { font-family: system-ui; padding: 16px; background: #fafafa; }
      textarea { width: 100%; min-height: 120px; margin-top: 8px; }
      pre { background: #fff; padding: 12px; border-radius: 8px; white-space: pre-wrap; }
      button { margin-top: 8px; padding: 8px 12px; }
    </style>
  </head>
  <body>
    <h2>AI Analysis (POC)</h2>
    <p>↓ ダッシュボード傾向などを入力してAI分析できます。</p>

    <textarea id="prompt" placeholder="例：そよ風の患者増加傾向を分析して"></textarea>
    <button id="run">AI分析</button>

    <h3>結果</h3>
    <pre id="output">（ここに結果が出ます）</pre>

    <!-- 🔹 seed data -->
<script type="application/json" id="seed-data">
{
  "schema": ["拠点名","25/04","25/05","25/06","25/07","25/08","25/09","25/10","25/11","総計"],
  "rows": [
    ["あげお", null,  null,  35, 24, 22, 10, 12, null, 103],
    ["そよ風", 25,    44,    57, 75, 77, 73, 34, 1,   386],
    ["そよ風・白石",29,    23,    25, 30, 67, 13, 18, null,205],
    ["プリム", null,  null,  null,null,19, 13, 18, 10, 60],
    ["伊勢崎",34,    25,    44, 24, 31, 28, 22, null,208],
    ["吉田",  45,    38,    43, 34, 44, 46, 23, 1,   274],
    ["吉田名西",null,null,  null,null,null,19, 22, 14, 55],
    ["国分寺",10,    11,    6,  6,  6,  9,  4,  null,52],
    ["堺",    12,    12,    10, 11, 10, 8,  6,  null,69],
    ["札幌",  null,  null,  null,null,null,null,8,  null,8],
    ["市原",  20,    64,    18, 15, 7,  25, 7,  null,156],
    ["市川",  14,    24,    15, 19, 14, 15, 4,  4,   109],
    ["守谷",  19,    12,    23, 22, 14, 5,  null,null,95],
    ["青野",  17,    13,    34, 19, 7,  14, 3,  null,107],
    ["摂津",  2,     5,     4,  5,  3,  6,  5,  null,30],
    ["仙台",  5,     5,     21, 19, 32, 38, 25, null,145],
    ["前橋",  35,    21,    28, 29, 22, 33, 19, null,187],
    ["蘇我",  37,    30,    35, 28, 2,  null,null,null,132],
    ["町田",  27,    25,    16, 17, 15, 28, 13, null,141],
    ["天王町",50,    22,    28, 36, 48, 21, null,null,205],
    ["南増尾",null,  null,  null,null,16, 7,  null,null,23],
    ["日立",  4,     15,    8,  12, 10, 12, 9,  null,70],
    ["八潮",  null,  null,  null,null,23, 19, 21, 18, 81],
    ["府中",  5,     6,     11, 12, 7,  12, null,null,53],
    ["豊橋",  13,    7,     10, 10, 14, 13, 3,  null,70]
  ]
}
</script>


    <script>
      const API_KEY = "AIzaSyB1Qf-xLUvF6NZpGXl9r4EHEhNyKrvdXTk";
      const MODEL = "gemini-2.5-pro";

      async function callGemini(prompt, data) {
        const url = `https://generativelanguage.googleapis.com/v1beta/models/${MODEL}:generateContent?key=${API_KEY}`;
        const body = {
          contents: [{
            role: "user",
            parts: [{
              text: `次のデータを分析して：\n${JSON.stringify(data)}\n\n質問:${prompt}`
            }]
          }]
        };
        const res = await fetch(url, {
          method: "POST",
          headers: {"Content-Type": "application/json"},
          body: JSON.stringify(body)
        });
        if (!res.ok) {
          const err = await res.text();
          throw new Error(err);
        }
        const json = await res.json();
        return json?.candidates?.[0]?.content?.parts?.[0]?.text ?? "(応答なし)";
      }

      document.getElementById("run").addEventListener("click", async () => {
        const prompt = document.getElementById("prompt").value.trim();
        const seedData = JSON.parse(document.getElementById("seed-data").textContent);
        const out = document.getElementById("output");
        if (!prompt) return out.textContent = "質問を入力してください。";

        out.textContent = "分析中...";
        try {
          const result = await callGemini(prompt, seedData);
          out.textContent = result;
        } catch (err) {
          out.textContent = "エラー: " + err.message;
        }
      });
    </script>
  </body>
</html>
