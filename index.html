<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>AI Analysis POC</title>
  <style>
    body {
      font-family: system-ui;
      margin: 20px;
      line-height: 1.5;
    }
    textarea { width: 100%; min-height: 120px; margin-top: 8px; }
    button { padding: 8px 16px; margin-top: 8px; }
    pre { background: #f7f7f7; padding: 12px; border-radius: 8px; white-space: pre-wrap; }
  </style>
</head>
<body>

  <h2>AI分析ウィンドウ（POC）</h2>
  <textarea id="q" placeholder="例：2025年下期で増患が多かった拠点を分析して"></textarea>
  <br>
  <button id="run">AI分析</button>
  <pre id="out">（ここに結果が出ます）</pre>

  <!-- ✅ seed-data（データ埋め込み） -->
<script type="application/json" id="seed-data">
{
  "schema": ["拠点名","25/04","25/05","25/06","25/07","25/08","25/09","25/10","25/11","総計"],
  "rows": [
    ["あげお", null,  null,  35, 24, 22, 10, 12, null, 103],
    ["そよ風", 25,    44,    57, 75, 77, 73, 34, 1,   386],
    ["そよ風・白石",29,    23,    25, 30, 67, 13, 18, null,205],
    ["プリム", null,  null,  null,null,19, 13, 18, 10, 60],
    ["伊勢崎",34,    25,    44, 24, 31, 28, 22, null,208],
    ["吉田",  45,    38,    43, 34, 44, 46, 23, 1,   274],
    ["吉田名西",null,null,  null,null,null,19, 22, 14, 55],
    ["国分寺",10,    11,    6,  6,  6,  9,  4,  null,52],
    ["堺",    12,    12,    10, 11, 10, 8,  6,  null,69],
    ["札幌",  null,  null,  null,null,null,null,8,  null,8],
    ["市原",  20,    64,    18, 15, 7,  25, 7,  null,156],
    ["市川",  14,    24,    15, 19, 14, 15, 4,  4,   109],
    ["守谷",  19,    12,    23, 22, 14, 5,  null,null,95],
    ["青野",  17,    13,    34, 19, 7,  14, 3,  null,107],
    ["摂津",  2,     5,     4,  5,  3,  6,  5,  null,30],
    ["仙台",  5,     5,     21, 19, 32, 38, 25, null,145],
    ["前橋",  35,    21,    28, 29, 22, 33, 19, null,187],
    ["蘇我",  37,    30,    35, 28, 2,  null,null,null,132],
    ["町田",  27,    25,    16, 17, 15, 28, 13, null,141],
    ["天王町",50,    22,    28, 36, 48, 21, null,null,205],
    ["南増尾",null,  null,  null,null,16, 7,  null,null,23],
    ["日立",  4,     15,    8,  12, 10, 12, 9,  null,70],
    ["八潮",  null,  null,  null,null,23, 19, 21, 18, 81],
    ["府中",  5,     6,     11, 12, 7,  12, null,null,53],
    ["豊橋",  13,    7,     10, 10, 14, 13, 3,  null,70]
  ]
}
</script>
  
  <!-- ✅ AI分析スクリプト -->
  <script>
  const GEMINI_API_KEY = "AIzaSyB1Qf-xLUvF6NZpGXl9r4EHEhNyKrvdXTk"; // ← 差し替え

  async function callGemini(prompt) {
    const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-pro:generateContent?key=${GEMINI_API_KEY}`;
    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
    const res = await fetch(url, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    return data?.candidates?.[0]?.content?.parts?.[0]?.text || "応答なし";
  }

  function summarizeSeed() {
    const el = document.getElementById("seed-data");
    const json = JSON.parse(el.textContent);
    const head = json.schema;
    const rows = json.rows;
    const total = rows.reduce((s, r) => s + (r[r.length - 1] || 0), 0);
    return `拠点数:${rows.length}, 合計:${total}`;
  }

  document.getElementById("run").onclick = async () => {
    const q = document.getElementById("q").value;
    const out = document.getElementById("out");
    out.textContent = "分析中...";
    const summary = summarizeSeed();
    const prompt = `あなたはデータアナリストです。\nデータ要約:${summary}\n質問:${q}`;
    try {
      const text = await callGemini(prompt);
      out.textContent = text;
    } catch(e) {
      out.textContent = "エラー: " + e.message;
    }
  };
  </script>

</body>
</html>
